!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof module&&module.exports?module.exports=t():e.Tobi=t()}(this,function(){"use strict";return function(e){var c={},o=null,u=[],m=0,b=[],p=0,a={},t=!1,g=null,v=document.createElement("div");v.setAttribute("role","dialog"),v.setAttribute("aria-hidden","true"),v.classList.add("tobi-overlay"),document.getElementsByTagName("body")[0].appendChild(v);var f=document.createElement("div");f.classList.add("tobi-slider"),v.appendChild(f);var h=document.createElement("button");h.setAttribute("type","button"),h.setAttribute("aria-label","Previous"),v.appendChild(h);var y=document.createElement("button");y.setAttribute("type","button"),y.setAttribute("aria-label","Next"),v.appendChild(y);var E=document.createElement("button");E.setAttribute("type","button"),E.setAttribute("aria-label","Close"),v.appendChild(E);var L=document.createElement("div");L.classList.add("tobi-counter"),v.appendChild(L);var A=function(e,t){if(void 0!==u[e]&&void 0!==b[e])if(b[e].getElementsByTagName("img")[0].hasAttribute("data-src")){var n=b[e].getElementsByTagName("figure")[0],i=n.getElementsByTagName("img")[0],o=n.getElementsByTagName("figcaption")[0];i.onload=function(){var e=n.querySelector(".tobi-loader");n.removeChild(e),i.style.opacity="1",o&&(o.style.opacity="1")},i.setAttribute("src",i.getAttribute("data-src")),i.removeAttribute("data-src"),t&&t()}else t&&t()},T=function(){var e=100*-p+"%";f.style[o]="translate3d("+e+", 0, 0)"},k=function(){L.innerHTML=p+1+"/"+u.length},C=function(e){c.nav?(h.disabled=!1,y.disabled=!1,p===u.length-1?y.disabled=!0:0===p&&(h.disabled=!0),"none"!==e||y.disabled?"none"===e&&y.disabled&&!h.disabled?h.focus():y.disabled||"right"!==e?y.disabled&&"right"===e&&!h.disabled?h.focus():h.disabled||"left"!==e?h.disabled&&"left"===e&&!y.disabled&&y.focus():h.focus():y.focus():y.focus()):c.close&&E.focus()},w=function(e){A(e)},s=function(){p<u.length-1&&(p++,T(),k(),C("right"),w(p+1))},r=function(){0<p&&(p--,T(),k(),C("left"),w(p-1))},d=function(){"true"!==v.getAttribute("aria-hidden")&&(c.scroll||(document.documentElement.classList.remove("tobi--is-open"),document.body.classList.remove("tobi--is-open")),S(),v.setAttribute("aria-hidden","true"),g.focus())},X=function(){a={startX:0,endX:0,startY:0,endY:0}},n=function(){var e=a.endX-a.startX,t=a.endY-a.startY,n=Math.abs(e),i=Math.abs(t);0<e&&n>c.threshold?r():e<0&&n>c.threshold?s():t<0&&i>c.threshold&&c.swipeClose&&d()},i=function(e){this===h?r():this===y?s():(this===E||this===v&&-1!==e.target.id.indexOf("tobi-figure-wrapper"))&&d(),e.preventDefault()},l=function(e){switch(e.keyCode){case 37:r();break;case 39:s();break;case 27:d()}},x=function(e){e.stopPropagation(),t=!0,a.startX=e.touches[0].pageX,a.startY=e.touches[0].pageY},N=function(e){e.preventDefault(),e.stopPropagation(),t&&(a.endX=e.touches[0].pageX,a.endY=e.touches[0].pageY)},B=function(e){e.stopPropagation(),t=!1,a.endX&&n(),X()},M=function(e){e.preventDefault(),e.stopPropagation(),t=!0,a.startX=e.pageX},H=function(e){e.stopPropagation(),t=!1,f.style.cursor="-webkit-grab",a.endX&&n(),X()},Y=function(e){e.preventDefault(),t&&(a.endX=e.pageX,f.style.cursor="-webkit-grabbing")},P=function(e){t&&(t=!1,f.style.cursor="-webkit-grab",a.endX=e.pageX,n(),X())},z=function(e){"false"!==v.getAttribute("aria-hidden")||v.contains(e.target)||(e.stopPropagation(),C("none"))},D=function(){c.keyboard&&document.addEventListener("keydown",l),c.docClose&&v.addEventListener("click",i),h.addEventListener("click",i),y.addEventListener("click",i),E.addEventListener("click",i),c.draggable&&(v.addEventListener("touchstart",x),v.addEventListener("touchmove",N),v.addEventListener("touchend",B),v.addEventListener("mousedown",M),v.addEventListener("mouseup",H),v.addEventListener("mouseleave",P),v.addEventListener("mousemove",Y)),document.addEventListener("focus",z,!0)},S=function(){c.keyboard&&document.removeEventListener("keydown",l),c.docClose&&v.removeEventListener("click",i),h.removeEventListener("click",i),y.removeEventListener("click",i),E.removeEventListener("click",i),c.draggable&&(v.removeEventListener("touchstart",x),v.removeEventListener("touchmove",N),v.removeEventListener("touchend",B),v.removeEventListener("mousedown",M),v.removeEventListener("mouseup",H),v.removeEventListener("mouseleave",P),v.removeEventListener("mousemove",Y)),document.removeEventListener("focus",z)},j=function(e){if(-1===u.indexOf(e)){if(u.push(e),e.classList.add("tobi"),c.zoom&&e.getElementsByTagName("img")[0]){var t=document.createElement("div");t.classList.add("tobi__zoom-icon"),t.innerHTML=c.zoomText,e.classList.add("tobi--zoom"),e.appendChild(t)}e.addEventListener("click",function(e){var t;e.preventDefault(),t=u.indexOf(this),"false"!==v.getAttribute("aria-hidden")&&(c.scroll||(document.documentElement.classList.add("tobi--is-open"),document.body.classList.add("tobi--is-open")),g=document.activeElement,p=t,X(),D(),A(p,function(){w(p+1),w(p-1)}),T(),k(),v.setAttribute("aria-hidden","false"),C("none"))}),n=e,s=[],r=a=o=i=null,d=[],(l=document.createElement("div")).classList.add("tobi-slide"),l.id="tobi-slide-"+u.length,(i=document.createElement("div")).classList.add("tobi-figure-wrapper"),i.id="tobi-figure-wrapper-"+u.length,(o=document.createElement("figure")).innerHTML='<div class="tobi-loader"></div>',(a=document.createElement("img")).style.opacity="0",n.getElementsByTagName("img")[0]&&n.getElementsByTagName("img")[0].alt?a.alt=n.getElementsByTagName("img")[0].alt:a.alt="",a.setAttribute("src",""),a.setAttribute("data-src",n.href),o.appendChild(a),c.captions&&((r=document.createElement("figcaption")).style.opacity="0","self"===c.captionsSelector&&n.getAttribute(c.captionAttribute)?r.innerHTML=n.getAttribute(c.captionAttribute):"img"===c.captionsSelector&&n.getElementsByTagName("img")[0].getAttribute(c.captionAttribute)&&(r.innerHTML=n.getElementsByTagName("img")[0].getAttribute(c.captionAttribute)),r.innerHTML&&(o.id="tobi-figure-"+m,r.id="tobi-figcaption-"+m,o.appendChild(r),s.push("tobi-figure-"+m),d.push("tobi-figcaption-"+m),++m)),i.appendChild(o),l.appendChild(i),f.appendChild(l),b.push(l),0!==m&&(v.setAttribute("aria-labelledby",s.join(" ")),v.setAttribute("aria-describedby",d.join(" "))),!c.nav||1===u.length||"auto"===c.nav&&"ontouchstart"in window?(h.style.display="none",y.style.display="none"):(h.style.display="initial",y.style.display="initial",h.innerHTML=c.navText[0],y.innerHTML=c.navText[1]),c.counter&&1!==u.length||(L.style.display="none"),c.close?E.innerHTML=c.closeText:E.style.display="none",c.draggable&&(f.style.cursor="-webkit-grab")}var n,i,o,a,s,r,d,l};this.add=function(e){j(e)},function(e){var t,n;n={selector:".lightbox",captions:!0,captionsSelector:"self",captionAttribute:"title",nav:"auto",navText:["&lsaquo;","&rsaquo;"],close:!0,closeText:"&times;",counter:!0,keyboard:!0,zoom:!0,zoomText:"&plus;",docClose:!1,swipeClose:!0,scroll:!1,draggable:!0,threshold:20},(t=e)&&Object.keys(t).forEach(function(e){n[e]=t[e]}),c=n,o="string"==typeof document.documentElement.style.transform?"transform":"WebkitTransform";var i=document.querySelectorAll(c.selector);i.length?[].forEach.call(i,function(e){j(e)}):console.log("Ups, I can't find the selector "+c.selector+".")}(e)}});