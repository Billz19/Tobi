!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof module&&module.exports?module.exports=t():e.Tobi=t()}(this,function(){"use strict";return function(e){var t={},n=null,i=[],o=0,a=[],s=0,r={},d=!1,l=null,c=document.createElement("div");c.setAttribute("role","dialog"),c.setAttribute("aria-hidden","true"),c.classList.add("tobi-overlay"),document.getElementsByTagName("body")[0].appendChild(c);var u=document.createElement("div");u.classList.add("tobi-slider"),c.appendChild(u);var m=document.createElement("button");m.setAttribute("type","button"),m.setAttribute("aria-label","Previous"),c.appendChild(m);var b=document.createElement("button");b.setAttribute("type","button"),b.setAttribute("aria-label","Next"),c.appendChild(b);var p=document.createElement("button");p.setAttribute("type","button"),p.setAttribute("aria-label","Close"),c.appendChild(p);var g=document.createElement("div");g.classList.add("tobi-counter"),c.appendChild(g);var v=function(e,t){if(void 0!==i[e]&&void 0!==a[e])if(a[e].getElementsByTagName("img")[0].hasAttribute("data-src")){var n=a[e].getElementsByTagName("figure")[0],o=n.getElementsByTagName("img")[0],s=n.getElementsByTagName("figcaption")[0];o.onload=function(){var e=n.querySelector(".tobi-loader");n.removeChild(e),o.style.opacity="1",s&&(s.style.opacity="1")},o.setAttribute("src",o.getAttribute("data-src")),o.removeAttribute("data-src"),t&&t()}else t&&t()},f=function(){var e=100*-s+"%";u.style[n]="translate3d("+e+", 0, 0)"},h=function(){g.innerHTML=s+1+"/"+i.length},y=function(e){t.nav?(m.disabled=!1,b.disabled=!1,s===i.length-1?b.disabled=!0:0===s&&(m.disabled=!0),"none"!==e||b.disabled?"none"===e&&b.disabled&&!m.disabled?m.focus():b.disabled||"right"!==e?b.disabled&&"right"===e&&!m.disabled?m.focus():m.disabled||"left"!==e?m.disabled&&"left"===e&&!b.disabled&&b.focus():m.focus():b.focus():b.focus()):t.close&&p.focus()},E=function(e){v(e)},L=function(){s<i.length-1&&(s++,f(),h(),y("right"),E(s+1))},A=function(){s>0&&(s--,f(),h(),y("left"),E(s-1))},T=function(){"true"!==c.getAttribute("aria-hidden")&&(t.scroll||(document.documentElement.classList.remove("tobi--is-open"),document.body.classList.remove("tobi--is-open")),S(),c.setAttribute("aria-hidden","true"),l.focus())},k=function(){r={startX:0,endX:0,startY:0,endY:0}},C=function(){var e=r.endX-r.startX,n=r.endY-r.startY,i=Math.abs(e),o=Math.abs(n);e>0&&i>t.threshold?A():e<0&&i>t.threshold?L():n<0&&o>t.threshold&&t.swipeClose&&T()},w=function(e){this===m?A():this===b?L():(this===p||this===c&&-1!==e.target.id.indexOf("tobi-figure-wrapper"))&&T(),e.preventDefault()},X=function(e){switch(e.keyCode){case 37:A();break;case 39:L();break;case 27:T()}},x=function(e){e.stopPropagation(),d=!0,r.startX=e.touches[0].pageX,r.startY=e.touches[0].pageY},N=function(e){e.preventDefault(),e.stopPropagation(),d&&(r.endX=e.touches[0].pageX,r.endY=e.touches[0].pageY)},B=function(e){e.stopPropagation(),d=!1,r.endX&&C(),k()},M=function(e){e.preventDefault(),e.stopPropagation(),d=!0,r.startX=e.pageX},H=function(e){e.stopPropagation(),d=!1,u.style.cursor="-webkit-grab",r.endX&&C(),k()},Y=function(e){e.preventDefault(),d&&(r.endX=e.pageX,u.style.cursor="-webkit-grabbing")},P=function(e){d&&(d=!1,u.style.cursor="-webkit-grab",r.endX=e.pageX,C(),k())},z=function(e){"false"!==c.getAttribute("aria-hidden")||c.contains(e.target)||(e.stopPropagation(),y("none"))},D=function(){t.keyboard&&document.addEventListener("keydown",X),t.docClose&&c.addEventListener("click",w),m.addEventListener("click",w),b.addEventListener("click",w),p.addEventListener("click",w),t.draggable&&(c.addEventListener("touchstart",x),c.addEventListener("touchmove",N),c.addEventListener("touchend",B),c.addEventListener("mousedown",M),c.addEventListener("mouseup",H),c.addEventListener("mouseleave",P),c.addEventListener("mousemove",Y)),document.addEventListener("focus",z,!0)},S=function(){t.keyboard&&document.removeEventListener("keydown",X),t.docClose&&c.removeEventListener("click",w),m.removeEventListener("click",w),b.removeEventListener("click",w),p.removeEventListener("click",w),t.draggable&&(c.removeEventListener("touchstart",x),c.removeEventListener("touchmove",N),c.removeEventListener("touchend",B),c.removeEventListener("mousedown",M),c.removeEventListener("mouseup",H),c.removeEventListener("mouseleave",P),c.removeEventListener("mousemove",Y)),document.removeEventListener("focus",z)},j=function(e){if(-1===i.indexOf(e)){if(i.push(e),e.classList.add("tobi"),t.zoom&&e.getElementsByTagName("img")[0]){var n=document.createElement("div");n.classList.add("tobi__zoom-icon"),n.innerHTML=t.zoomText,e.classList.add("tobi--zoom"),e.appendChild(n)}e.addEventListener("click",function(e){var n;e.preventDefault(),n=i.indexOf(this),"false"!==c.getAttribute("aria-hidden")&&(t.scroll||(document.documentElement.classList.add("tobi--is-open"),document.body.classList.add("tobi--is-open")),l=document.activeElement,s=n,k(),D(),v(s,function(){E(s+1),E(s-1)}),f(),h(),c.setAttribute("aria-hidden","false"),y("none"))}),r=e,d=null,L=null,A=null,T=[],C=null,w=[],(X=document.createElement("div")).classList.add("tobi-slide"),X.id="tobi-slide-"+i.length,(d=document.createElement("div")).classList.add("tobi-figure-wrapper"),d.id="tobi-figure-wrapper-"+i.length,(L=document.createElement("figure")).innerHTML='<div class="tobi-loader"></div>',(A=document.createElement("img")).style.opacity="0",r.getElementsByTagName("img")[0]&&r.getElementsByTagName("img")[0].alt?A.alt=r.getElementsByTagName("img")[0].alt:A.alt="",A.setAttribute("src",""),A.setAttribute("data-src",r.href),L.appendChild(A),t.captions&&((C=document.createElement("figcaption")).style.opacity="0","self"===t.captionsSelector&&r.getAttribute(t.captionAttribute)?C.innerHTML=r.getAttribute(t.captionAttribute):"img"===t.captionsSelector&&r.getElementsByTagName("img")[0].getAttribute(t.captionAttribute)&&(C.innerHTML=r.getElementsByTagName("img")[0].getAttribute(t.captionAttribute)),C.innerHTML&&(L.id="tobi-figure-"+o,C.id="tobi-figcaption-"+o,L.appendChild(C),T.push("tobi-figure-"+o),w.push("tobi-figcaption-"+o),++o)),d.appendChild(L),X.appendChild(d),u.appendChild(X),a.push(X),0!==o&&(c.setAttribute("aria-labelledby",T.join(" ")),c.setAttribute("aria-describedby",w.join(" "))),!t.nav||1===i.length||"auto"===t.nav&&"ontouchstart"in window?(m.style.display="none",b.style.display="none"):(m.style.display="initial",b.style.display="initial",m.innerHTML=t.navText[0],b.innerHTML=t.navText[1]),t.counter&&1!==i.length||(g.style.display="none"),t.close?p.innerHTML=t.closeText:p.style.display="none",t.draggable&&(u.style.cursor="-webkit-grab")}var r,d,L,A,T,C,w,X};this.add=function(e){j(e)},function(e){var i,o;o={selector:".lightbox",captions:!0,captionsSelector:"self",captionAttribute:"title",nav:"auto",navText:["&lsaquo;","&rsaquo;"],close:!0,closeText:"&times;",counter:!0,keyboard:!0,zoom:!0,zoomText:"&plus;",docClose:!1,swipeClose:!0,scroll:!1,draggable:!0,threshold:20},(i=e)&&Object.keys(i).forEach(function(e){o[e]=i[e]}),t=o,n="string"==typeof document.documentElement.style.transform?"transform":"WebkitTransform";var a=document.querySelectorAll(t.selector);a.length?[].forEach.call(a,function(e){j(e)}):console.log("Ups, I can't find the selector "+t.selector+".")}(e)}});